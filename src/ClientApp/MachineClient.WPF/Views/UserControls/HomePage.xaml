<UserControl x:Class="MachineClient.WPF.Views.UserControls.HomePage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes">
    
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <BooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter"/>
    </UserControl.Resources>
    
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="12">
            
            <!-- Machine Information Card -->
            <materialDesign:Card Padding="16" Margin="0,0,0,12" Background="{DynamicResource MaterialDesignCardBackground}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Header with Reload Button -->
                    <Grid Grid.Row="0" Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="Machine Information" 
                                   FontSize="16" FontWeight="Medium"
                                   Foreground="{DynamicResource MaterialDesignBody}"/>
                        <Button Grid.Column="1" 
                                Command="{Binding UpdateMachineInfoCommand}"
                                Style="{StaticResource MaterialDesignIconButton}"
                                Width="28" Height="28"
                                Padding="2">
                            <materialDesign:PackIcon Kind="Reload" Width="14" Height="14"/>
                        </Button>
                    </Grid>
                    
                    <!-- Machine Info Grid - 3 columns layout -->
                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <!-- Column 0: Buyer & Station -->
                        <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,8,4">
                            <TextBlock Text="Buyer" FontSize="9" Foreground="{DynamicResource MaterialDesignBodyLight}" FontWeight="Medium"/>
                            <TextBlock Text="{Binding BuyerName}" FontSize="11" Foreground="{DynamicResource MaterialDesignBody}" Margin="0,1,0,0"/>
                        </StackPanel>
                        <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,8,4">
                            <TextBlock Text="Station" FontSize="9" Foreground="{DynamicResource MaterialDesignBodyLight}" FontWeight="Medium"/>
                            <TextBlock Text="{Binding StationName}" FontSize="11" Foreground="{DynamicResource MaterialDesignBody}" Margin="0,1,0,0"/>
                        </StackPanel>
                        
                        <!-- Column 1: Line & Model -->
                        <StackPanel Grid.Row="0" Grid.Column="1" Margin="4,0,4,4">
                            <TextBlock Text="Line" FontSize="9" Foreground="{DynamicResource MaterialDesignBodyLight}" FontWeight="Medium"/>
                            <TextBlock Text="{Binding LineName}" FontSize="11" Foreground="{DynamicResource MaterialDesignBody}" Margin="0,1,0,0"/>
                        </StackPanel>
                        <StackPanel Grid.Row="1" Grid.Column="1" Margin="4,0,4,4">
                            <TextBlock Text="Model" FontSize="9" Foreground="{DynamicResource MaterialDesignBodyLight}" FontWeight="Medium"/>
                            <TextBlock Text="{Binding ModelName}" FontSize="11" Foreground="{DynamicResource MaterialDesignBody}" Margin="0,1,0,0"/>
                        </StackPanel>
                        
                        <!-- Column 2: Program & Machine Name -->
                        <StackPanel Grid.Row="0" Grid.Column="2" Margin="8,0,0,4">
                            <TextBlock Text="Program" FontSize="9" Foreground="{DynamicResource MaterialDesignBodyLight}" FontWeight="Medium"/>
                            <TextBlock Text="{Binding ProgramName}" FontSize="11" Foreground="{DynamicResource MaterialDesignBody}" Margin="0,1,0,0"/>
                        </StackPanel>
                        <StackPanel Grid.Row="1" Grid.Column="2" Margin="8,0,0,4">
                            <TextBlock Text="Machine Name" FontSize="9" Foreground="{DynamicResource MaterialDesignBodyLight}" FontWeight="Medium"/>
                            <TextBlock Text="{Binding MachineId}" 
                                       AutomationProperties.AutomationId="MachineIdTextBlock"
                                       AutomationProperties.Name="Machine ID"
                                       FontSize="11" Foreground="{DynamicResource MaterialDesignBody}" Margin="0,1,0,0"/>
                        </StackPanel>
                    </Grid>
                    
                    <!-- Last Update -->
                    <StackPanel Grid.Row="2" Margin="0,8,0,0">
                        <TextBlock Text="Last Update" FontSize="9" Foreground="{DynamicResource MaterialDesignBodyLight}" FontWeight="Medium"/>
                        <TextBlock Text="{Binding LastUpdateTime, StringFormat='yyyy-MM-dd HH:mm:ss'}" 
                                   FontSize="10" Foreground="{DynamicResource MaterialDesignBody}" Margin="0,1,0,0"/>
                    </StackPanel>
                </Grid>
            </materialDesign:Card>

            <!-- Pin Count Table -->
            <materialDesign:Card Padding="16" Margin="0,0,0,12">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <TextBlock Grid.Row="0" Text="Pin Count Status" 
                               FontSize="16" FontWeight="Medium"
                               Foreground="{DynamicResource MaterialDesignBody}"
                               Margin="0,0,0,12"/>
                    
                    <DataGrid Grid.Row="1" 
                              ItemsSource="{Binding PinCounts}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              HeadersVisibility="All"
                              GridLinesVisibility="Horizontal"
                              RowHeight="28"
                              materialDesign:DataGridAssist.CellPadding="4,2"
                              materialDesign:DataGridAssist.ColumnHeaderPadding="4,3">
                        
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Pin Name" 
                                              Binding="{Binding PinName}" 
                                              Width="120"
                                              IsReadOnly="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="FontSize" Value="11"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            
                            <DataGridTextColumn Header="Usage" 
                                              Binding="{Binding Usage}" 
                                              Width="70"
                                              IsReadOnly="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="FontSize" Value="11"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="TextAlignment" Value="Right"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            
                            <DataGridTextColumn Header="Lifetime" 
                                              Binding="{Binding Lifetime}" 
                                              Width="75"
                                              IsReadOnly="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="FontSize" Value="11"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="TextAlignment" Value="Right"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            
                            <DataGridTextColumn Header="Usage %" 
                                              Binding="{Binding UsagePercentage, StringFormat=F1}" 
                                              Width="65"
                                              IsReadOnly="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="FontSize" Value="11"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="TextAlignment" Value="Right"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            
                            <DataGridTextColumn Header="Warning" 
                                              Binding="{Binding Warning}" 
                                              Width="110"
                                              IsReadOnly="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="FontSize" Value="10"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="TextWrapping" Value="Wrap"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            
                            <DataGridTemplateColumn Header="Action" Width="75">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="Reset" 
                                                Command="{Binding DataContext.ResetPinCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"
                                                materialDesign:ButtonAssist.CornerRadius="3"
                                                Padding="6,2"
                                                FontSize="9"
                                                Height="22"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                        
                        <DataGrid.RowStyle>
                            <Style TargetType="DataGridRow">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsError}" Value="True">
                                        <Setter Property="Background" Value="#FFEBEE"/>
                                        <Setter Property="Foreground" Value="#B71C1C"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding IsWarning}" Value="True">
                                        <Setter Property="Background" Value="#FFF8E1"/>
                                        <Setter Property="Foreground" Value="#E65100"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.RowStyle>
                    </DataGrid>
                </Grid>
            </materialDesign:Card>
            
            <!-- Backup Section -->
            <materialDesign:Card Padding="16" Margin="0,0,0,12" Background="{DynamicResource MaterialDesignCardBackground}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Header -->
                    <TextBlock Grid.Row="0" Text="Data Backup" 
                               FontSize="16" FontWeight="Medium"
                               Foreground="{DynamicResource MaterialDesignBody}"
                               Margin="0,0,0,12"/>
                    
                    <!-- Next Backup Time Info -->
                    <TextBlock Grid.Row="0" 
                               Text="{Binding NextBackupTime}"
                               FontSize="11"
                               Foreground="{DynamicResource MaterialDesignBodyLight}"
                               HorizontalAlignment="Right"
                               VerticalAlignment="Center"
                               Margin="0,0,0,12"
                               Visibility="{Binding NextBackupTime, Converter={StaticResource StringToVisibilityConverter}}"/>
                    
                    <!-- Progress Bar -->
                    <Grid Grid.Row="1" Margin="0,0,0,12">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <!-- Progress Bar Row -->
                        <Grid Grid.Row="0" Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <ProgressBar Grid.Column="0" 
                                         Height="8"
                                         Value="{Binding BackupProgress}"
                                         Maximum="100"
                                         Style="{StaticResource MaterialDesignLinearProgressBar}"
                                         VerticalAlignment="Center"
                                         Margin="0,0,12,0">
                                <ProgressBar.Visibility>
                                    <Binding Path="IsBackupInProgress" Converter="{StaticResource BooleanToVisibilityConverter}"/>
                                </ProgressBar.Visibility>
                            </ProgressBar>
                            
                            <TextBlock Grid.Column="1" 
                                       Text="{Binding BackupProgressText}"
                                       AutomationProperties.AutomationId="BackupProgressTextBlock"
                                       AutomationProperties.Name="Backup Progress"
                                       FontSize="11"
                                       Foreground="{DynamicResource MaterialDesignBodyLight}"
                                       VerticalAlignment="Center">
                                <TextBlock.Visibility>
                                    <Binding Path="IsBackupInProgress" Converter="{StaticResource BooleanToVisibilityConverter}"/>
                                </TextBlock.Visibility>
                            </TextBlock>
                        </Grid>
                        
                        <!-- Progress Detail Text -->
                        <Grid Grid.Row="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBlock Grid.Column="0" 
                                       Text="{Binding BackupFileProgressText}"
                                       FontSize="10"
                                       Foreground="{DynamicResource MaterialDesignBodyLight}"
                                       VerticalAlignment="Center">
                                <TextBlock.Visibility>
                                    <Binding Path="IsBackupInProgress" Converter="{StaticResource BooleanToVisibilityConverter}"/>
                                </TextBlock.Visibility>
                            </TextBlock>
                            
                            <TextBlock Grid.Column="1" 
                                       Text="{Binding BackupSizeProgressText}"
                                       FontSize="10"
                                       Foreground="{DynamicResource MaterialDesignBodyLight}"
                                       VerticalAlignment="Center"
                                       TextAlignment="Right">
                                <TextBlock.Visibility>
                                    <Binding Path="IsBackupInProgress" Converter="{StaticResource BooleanToVisibilityConverter}"/>
                                </TextBlock.Visibility>
                            </TextBlock>
                        </Grid>
                    </Grid>
                    
                    <!-- Backup Controls -->
                    <Grid Grid.Row="2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Backup Button -->
                        <Button Grid.Column="0" 
                                Command="{Binding StartBackupCommand}"
                                AutomationProperties.AutomationId="StartBackupButton"
                                AutomationProperties.Name="Start Backup"
                                Height="32"
                                Padding="16,0"
                                Margin="0,0,8,0">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource MaterialDesignRaisedButton}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsBackupInProgress}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Download" 
                                                         Width="16" Height="16" 
                                                         VerticalAlignment="Center"
                                                         Margin="0,0,8,0"/>
                                <TextBlock Text="Start Backup" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>
                        
                        <!-- Stop Button -->
                        <Button Grid.Column="1" 
                                Command="{Binding StopBackupCommand}"
                                AutomationProperties.AutomationId="StopBackupButton"
                                AutomationProperties.Name="Stop Backup"
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Height="32"
                                Padding="16,0"
                                Margin="0,0,8,0"
                                Foreground="#F44336">
                            <Button.Visibility>
                                <Binding Path="IsBackupInProgress" Converter="{StaticResource BooleanToVisibilityConverter}"/>
                            </Button.Visibility>
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Stop" 
                                                         Width="16" Height="16" 
                                                         VerticalAlignment="Center"
                                                         Margin="0,0,8,0"/>
                                <TextBlock Text="Stop" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>
                        
                        <!-- Status Text -->
                        <TextBlock Grid.Column="2" 
                                   Text="{Binding BackupStatusText}"
                                   AutomationProperties.AutomationId="BackupStatusTextBlock"
                                   AutomationProperties.Name="Backup Status"
                                   FontSize="11"
                                   Foreground="{DynamicResource MaterialDesignBodyLight}"
                                   VerticalAlignment="Center"
                                   Margin="8,0,0,0"/>
                        
                        <!-- Last Backup Info -->
                        <TextBlock Grid.Column="3" 
                                   Text="{Binding LastBackupTime, StringFormat='Last: {0:MM/dd HH:mm}'}"
                                   FontSize="10"
                                   Foreground="{DynamicResource MaterialDesignBodyLight}"
                                   VerticalAlignment="Center"/>
                    </Grid>
                </Grid>
            </materialDesign:Card>
            
            <!-- UI Automation Demo Section -->
            <materialDesign:Card Padding="16" Margin="0,0,0,12" Background="{DynamicResource MaterialDesignCardBackground}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Header -->
                    <TextBlock Grid.Row="0" Text="UI Automation Demo" 
                               FontSize="16" FontWeight="Medium"
                               Foreground="{DynamicResource MaterialDesignBody}"
                               Margin="0,0,0,12"/>
                    
                    <!-- Automation Controls -->
                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <Button Grid.Column="0" 
                                Content="Demo All Features"
                                Command="{Binding TestUIAutomationCommand}"
                                AutomationProperties.AutomationId="DemoAllFeaturesButton"
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Height="28"
                                Padding="12,0"
                                FontSize="11"
                                Margin="0,0,8,0"/>
                        
                        <Button Grid.Column="1" 
                                Content="Start Pin Monitoring"
                                Command="{Binding StartPinCountMonitoringCommand}"
                                AutomationProperties.AutomationId="StartPinMonitoringButton"
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Height="28"
                                Padding="12,0"
                                FontSize="11"
                                Margin="0,0,8,0"/>
                        
                        <Button Grid.Column="2" 
                                Content="Stop Pin Monitoring"
                                Command="{Binding StopPinCountMonitoringCommand}"
                                AutomationProperties.AutomationId="StopPinMonitoringButton"
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Height="28"
                                Padding="12,0"
                                FontSize="11"
                                Margin="0,0,8,0"/>
                        
                        <Button Grid.Column="3" 
                                Content="Auto Click Backup"
                                Command="{Binding AutoClickBackupButtonCommand}"
                                AutomationProperties.AutomationId="AutoClickBackupButton"
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Height="28"
                                Padding="12,0"
                                FontSize="11"
                                Margin="0,0,8,0"/>
                        
                        <Button Grid.Column="4" 
                                Content="Read Machine ID"
                                Command="{Binding ReadMachineIdCommand}"
                                AutomationProperties.AutomationId="ReadMachineIdButton"
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Height="28"
                                Padding="12,0"
                                FontSize="11"
                                Margin="0,0,8,0"/>
                    </Grid>
                </Grid>
            </materialDesign:Card>

            <!-- Activity Log -->
            <materialDesign:Card Padding="20">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="300"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <TextBlock Grid.Row="0" Text="Activity Log" 
                               FontSize="20" FontWeight="Medium"
                               Margin="0,0,0,16"/>
                    
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <TextBox Text="{Binding LogText}" 
                                 IsReadOnly="True"
                                 AcceptsReturn="True"
                                 TextWrapping="Wrap"
                                 FontFamily="Consolas"
                                 FontSize="11"
                                 Background="Transparent"
                                 BorderThickness="0"/>
                    </ScrollViewer>
                    
                    <Button Grid.Row="2" Content="Clear Logs" 
                            Command="{Binding ClearLogsCommand}"
                            materialDesign:ButtonAssist.CornerRadius="4"
                            HorizontalAlignment="Right"
                            Margin="0,8,0,0"/>
                </Grid>
            </materialDesign:Card>
            
        </StackPanel>
    </ScrollViewer>
</UserControl>